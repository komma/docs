<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Adding behaviour classes to implement application logic</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Adding behaviour classes to implement application logic</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-process-engine">The process engine</a></li>
<li><a href="#a-simple-process-api">A simple process API</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#precedence">Precedence</a></li>
<li><a href="#behaviour-registration">Behaviour registration</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#tldr">TL;DR</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example makes use of KOMMA&#8217;s object mapping feature as described in
<a href="../objectmapping/index.html">Basic object triple mapping</a>
and it assumes you are familiar with that feature.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>KOMMA allows for binding classes with application logic, which we call
<em>Behaviours</em>, to mapped <em>Entities</em>.
In this tutorial, we want to show you how to use this feature.</p>
</div>
<div class="paragraph">
<p>The example we are going to use is a (very simple) process engine. This is
somewhat complex but don&#8217;t be alarmed, it is stripped down to a bare minimum
to highlight the general idea while still being a functional example.</p>
</div>
<div class="paragraph">
<p>The full source code of this tutorial is available in the
<a href="https://github.com/komma/komma-examples">KOMMA examples repository on github</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-process-engine"><a class="anchor" href="#the-process-engine"></a>The process engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To keep matters as simple as possible, we are going to have only four basic
elements: <em>Processes</em> consist of a number of <em>Activities</em> (some of which
are going to be <em>Tasks</em> requiring manual completion) that are connected by
outgoing <em>Transitions</em>.</p>
</div>
<div class="paragraph">
<p>Additionally, we need to distinguish between static and dynamic aspects for
defining and executing our processes. The mappings are therefore separated into
<em>DefinitionAspects</em> and <em>RuntimeAspects</em> that are themselves mapped entities
from which the other model elements are derived (yes, you can use inheritance
for mapped entities).</p>
</div>
<div class="paragraph">
<p>We arrive at the following application model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DefinitionAspect</p>
<div class="ulist">
<ul>
<li>
<p>ProcessDefinition</p>
</li>
<li>
<p>ActivityDefinition</p>
<div class="ulist">
<ul>
<li>
<p>TaskDefinition</p>
</li>
</ul>
</div>
</li>
<li>
<p>Transition (there is no dynamic aspect to transitions)</p>
</li>
</ul>
</div>
</li>
<li>
<p>RuntimeAspect</p>
<div class="ulist">
<ul>
<li>
<p>ProcessInstance</p>
</li>
<li>
<p>ActivityInstance</p>
<div class="ulist">
<ul>
<li>
<p>TaskInstance</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us just pick <em>ProcessDefinition</em> and have a look at it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.model</span>;

<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.annotations.Iri</span>;

<span class="annotation">@Iri</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://enilink.net/komma/example/behaviour#ProcessDefinition</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">ProcessDefinition</span> <span class="directive">extends</span> DefinitionAspect {

        <span class="annotation">@Iri</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://enilink.net/komma/example/behaviour#hasName</span><span class="delimiter">&quot;</span></span>)
        <span class="predefined-type">String</span> getName();

        <span class="type">void</span> setName(<span class="predefined-type">String</span> name);

        <span class="annotation">@Iri</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://enilink.net/komma/example/behaviour#hasActivity</span><span class="delimiter">&quot;</span></span>)
        <span class="predefined-type">Set</span>&lt;ActivityDefinition&gt; getHasActivity();

        <span class="type">void</span> setHasActivity(<span class="predefined-type">Set</span>&lt;? <span class="directive">extends</span> ActivityDefinition&gt; hasActivity);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This one maps two properties, one being the name for the process, the other
representing the activities it consists of.</p>
</div>
<div class="paragraph">
<p>For brevity, the rest of these mappings are omitted here, suffice to say they
are equally trivial. Please refer to the examples repository on github for the
details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-simple-process-api"><a class="anchor" href="#a-simple-process-api"></a>A simple process API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before defining the API for our runtime, there is one caveat to discuss:
a <em>Behaviour</em> needs to be bound to an already mapped <em>Entity</em>, so logic that
applies to definition aspects needs to be separated from logic that applies to
runtime instances.</p>
</div>
<div class="paragraph">
<p>To use <em>Process</em> as an example, the behaviour we are going to bind to
<em>ProcessDefinition</em> allows the creation of a matching <em>ProcessInstance</em>.
We then bind another behaviour to <em>ProcessInstance</em> which provides the methods
that operate on the runtime instance.</p>
</div>
<div class="paragraph">
<p>With that out of the way, this is what our very basic API for process execution
looks like (package and import statements omitted for brevity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IProcessDefinition</span> {
        <span class="directive">public</span> ProcessInstance createProcessInstance();
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">IProcessInstance</span> {
        <span class="directive">public</span> ProcessInstance start();
        <span class="directive">public</span> <span class="type">boolean</span> end();
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">IActivityDefinition</span> {
        <span class="directive">public</span> ActivityInstance createActivityInstance(
                        ProcessInstance processInstance);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">IActivityInstance</span> {
        <span class="directive">public</span> <span class="type">boolean</span> enter();
        <span class="directive">public</span> <span class="type">boolean</span> execute();
        <span class="directive">public</span> <span class="type">boolean</span> leave(<span class="predefined-type">String</span> transitionName);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">ITaskInstance</span> <span class="directive">extends</span> IActivityInstance {
        <span class="directive">public</span> <span class="type">boolean</span> complete(<span class="predefined-type">String</span> transitionName);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">ITransition</span> {
        <span class="directive">public</span> <span class="type">boolean</span> activate(ProcessInstance processInstance);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The fact that <em>ITaskInstance</em> extends <em>IActivityInstance</em> is relevant for
the discussion below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This concludes the definition of our mapped entities and the API we want to use
for our business logic (the process runtime).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation"><a class="anchor" href="#implementation"></a>Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us now take a look at the <em>Behaviour</em> class implementing our business
method for <em>IProcessDefinition</em> to get an idea about how these behaviour
implementations look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.runtime</span>;

<span class="keyword">import</span> <span class="include">java.util.UUID</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.traits.Behaviour</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.core.URI</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IProcessDefinition</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IProcessInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ProcessDefinition</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ProcessInstance</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ProcessDefinitionSupport</span> <span class="directive">implements</span> ProcessDefinition,
                Behaviour&lt;ProcessDefinition&gt;, IProcessDefinition {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> ProcessInstance createProcessInstance() {
                <span class="predefined-type">URI</span> piUri = getURI().appendFragment(
                                <span class="string"><span class="delimiter">&quot;</span><span class="content">ProcessInstance_</span><span class="delimiter">&quot;</span></span> + getURI().fragment() + <span class="string"><span class="delimiter">&quot;</span><span class="content">_</span><span class="delimiter">&quot;</span></span>
                                                + <span class="predefined-type">UUID</span>.randomUUID());

                ProcessInstance pi = getEntityManager().createNamed(piUri,
                                ProcessInstance.class);

                pi.setUsesDefinition(getBehaviourDelegate());

                pi = ((IProcessInstance) pi).start();

                <span class="keyword">return</span> pi;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the actual code for <em>createProcessInstance()</em> is pretty
straightforward. It really just creates a new named <em>ProcessInstance</em>, sets the
mapped entity on which it was called as the associated <em>ProcessDefinition</em>,
then returns the new <em>ProcessInstance</em> after calling <em>start()</em> on it (using
another of the API methods we defined).</p>
</div>
<div class="paragraph">
<p>With respect to the boilerplate code, we only define an abstract class (the
convention KOMMA uses is an appended <em>Support</em> suffix) that implements our
mapped entity, a <em>Behaviour&lt;&gt;</em> for the mapped entity and (optional) other
interfaces (in our case, the API we defined above).</p>
</div>
<div class="paragraph">
<p>Now, there must surely be some magic hidden somewhere in the implementation of
<em>IProcessInstance::start()</em>? See for yourself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.runtime</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.traits.Behaviour</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IActivityDefinition</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IProcessInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ActivityDefinition</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ProcessInstance</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ProcessInstanceSupport</span> <span class="directive">implements</span> ProcessInstance,
                Behaviour&lt;ProcessInstance&gt;, IProcessInstance {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> ProcessInstance start() {
                setState(STATE_ACTIVE);

                <span class="comment">// find and activate the start activity</span>
                <span class="comment">// for simplicity, just use name==&quot;start&quot; as indicator</span>
                <span class="keyword">for</span> (ActivityDefinition activityDef : getUsesDefinition()
                                .getHasActivity()) {
                        <span class="keyword">if</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>.equals(activityDef.getName())) {
                                ((IActivityDefinition) activityDef)
                                                .createActivityInstance(getBehaviourDelegate());
                        }
                }

                <span class="keyword">return</span> getBehaviourDelegate();
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> end() {
                setState(STATE_ENDED);

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Huh, this doesn&#8217;t look very different, after all! What&#8217;s the deal here, is
there more to it?</p>
</div>
<div class="paragraph">
<p><em>Why, yes, there is!</em></p>
</div>
<div class="paragraph">
<p>There&#8217;s a common mechanism that handles the mapped <em>Entities</em>, their accessor
methods to the underlying RDF store and the <em>Behaviours</em> that are bound to
them. We call this <a href="../composition">Object Composition</a> and it is actually
a very essential part to all of KOMMA.</p>
</div>
<div class="paragraph">
<p>Now, for our example, you don&#8217;t need to understand the details of how the
composition mechanism does all the work for you, the general outline will do
fine. What it boils down to here is that multiple <em>Behaviours</em> can be available
for a given <em>Entity</em> and interface. If we take a close look at <em>TaskInstance</em>,
we find that there are actually three <em>Behaviour</em> classes at work (*):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ActivityInstanceSupport (the base behaviour for <em>all</em> activities)</p>
</li>
<li>
<p>TaskInstanceSupport (specific behaviour for <em>Tasks</em>)</p>
</li>
<li>
<p>EndInstanceSupport (specific behaviour for <em>End</em> activities **)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us look at the first one from that list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.runtime</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.traits.Behaviour</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IActivityInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.ITransition</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ActivityInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.Transition</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ActivityInstanceSupport</span> <span class="directive">implements</span> ActivityInstance,
                Behaviour&lt;ActivityInstance&gt;, IActivityInstance {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> enter() {
                setState(STATE_OPEN);
                getProcessInstance().setCurrentActivity(getBehaviourDelegate());

                <span class="comment">// can be implemented by more specialized support classes</span>
                <span class="comment">// be sure to call them and don't just use this.execute()</span>
                ((IActivityInstance) getBehaviourDelegate()).execute();

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> execute() {
                <span class="keyword">if</span> (!STATE_OPEN.equals(getState())) {
                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Activity </span><span class="delimiter">&quot;</span></span> + getURI()
                                        + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not open.</span><span class="delimiter">&quot;</span></span>);
                }

                <span class="comment">// can be implemented by more specialized support classes</span>
                <span class="comment">// be sure to call them and don't just use this.leave()</span>
                ((IActivityInstance) getBehaviourDelegate()).leave(<span class="predefined-constant">null</span>);

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> leave(<span class="predefined-type">String</span> transitionName) {

                <span class="comment">// [... get the transition matching the given name ...]</span>

                setState(STATE_COMPLETED);
                setTransitionName(transitions[t].getName());

                ((ITransition) transitions[t]).activate(getProcessInstance());

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, as stated above, this is the base behaviour available for <em>all</em>
<em>ActivityInstances</em>, including those for <em>Tasks</em>. These also have their own
specific behaviour, which we&#8217;ll get to in a minute.</p>
</div>
<div class="paragraph">
<p>An <em>important</em> detail here is the way this base behaviour invokes the other
methods. Note that it does <em>not</em> call its own implementations directly but also
uses the composition mechanism to invoke the correct one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is due to the behaviours not actually inheriting from each other,
making virtual methods/dynamic dispatch unavailable for them. We can still
achieve the desired result, however, when we use the composition mechanism as
shown in the example.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="precedence"><a class="anchor" href="#precedence"></a>Precedence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you take a look at the second of the behaviours relevant to <em>TaskInstances</em>
from the list above, you&#8217;ll notice something we haven&#8217;t shown you yet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.runtime</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.annotations.Precedes</span>;
<span class="keyword">import</span> <span class="include">net.enilink.composition.traits.Behaviour</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IActivityInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.ITaskInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.TaskInstance</span>;

<span class="annotation">@Precedes</span>(ActivityInstanceSupport.class)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">TaskInstanceSupport</span> <span class="directive">implements</span> TaskInstance,
                Behaviour&lt;TaskInstance&gt;, ITaskInstance {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> execute() {
                <span class="comment">// this is a wait-state, not a normal activity</span>
                setState(STATE_AWAITING_COMPLETION);

                <span class="comment">// returning true here signals the end of the method chaining; in other</span>
                <span class="comment">// words, ActivityInstanceSupport.execute() will NOT be called</span>
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> complete(<span class="predefined-type">String</span> transitionName) {
                <span class="keyword">if</span> (!STATE_AWAITING_COMPLETION.equals(getState())) {
                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Task </span><span class="delimiter">&quot;</span></span> + getURI()
                                        + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not awaiting completion.</span><span class="delimiter">&quot;</span></span>);
                }

                ((IActivityInstance) getBehaviourDelegate()).leave(transitionName);

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This behaviour uses the <em>@Precedes</em> annotation to impose an order on the
otherwise unordered set of behaviours available for an entity. As detailed in
the <a href="../composition">Object Composition documentation</a>,
this will affect the method chaining mechanism by enforcing an invocation
order. For our specific case, this means that a call to a method of
<em>IActivityInstance</em> will execute the appropriate method of
<em>TaskInstanceSupport</em> before that of <em>ActivityInstanceSupport</em> (this is due to
<em>ITaskInstance</em> extending <em>IActivityInstance</em>, as noted above).</p>
</div>
<div class="paragraph">
<p>An important aspect of the method chaining is the influence of the return
value. Returning something non-null (or a boolean true) results in the chain
being stopped, whereas returning null (or false) causes the chain to continue
with the method on the next behaviour.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Imagine the return value as a kind of flag indicating something like
"We&#8217;re done here, I managed to come up with the answer".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With that being said, let&#8217;s look at the third behaviour relevant to
<em>ActivityInstances</em> (and therefore, as mentioned, to <em>TaskInstances</em> as well)
from the list above. This is more interesting, because it relies on <em>@Precedes</em>
as well as on the subtleties of return value and invocation chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.enilink.komma.example.behaviour.runtime</span>;

<span class="keyword">import</span> <span class="include">net.enilink.composition.annotations.Precedes</span>;
<span class="keyword">import</span> <span class="include">net.enilink.composition.traits.Behaviour</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IActivityInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.IProcessInstance</span>;
<span class="keyword">import</span> <span class="include">net.enilink.komma.example.behaviour.model.ActivityInstance</span>;

<span class="annotation">@Precedes</span>(ActivityInstanceSupport.class)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">EndInstanceSupport</span> <span class="directive">implements</span> ActivityInstance,
                Behaviour&lt;ActivityInstance&gt;, IActivityInstance {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> execute() {
                <span class="comment">// simplicity: name==&quot;end&quot; designates the end activity</span>
                <span class="keyword">if</span> (!<span class="string"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span>.equals(getUsesDefinition().getName())) {
                        <span class="comment">// returning false causes the invocation of this method on the next</span>
                        <span class="comment">// behaviour in the chain (here: ActivityInstanceSupport.execute())</span>
                        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
                }

                setState(STATE_COMPLETED);

                <span class="comment">// end activities just terminate the enclosing process instance</span>
                <span class="comment">// they cannot be left as there are no outgoing transitions</span>
                ((IProcessInstance) getProcessInstance()).end();

                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prior to explaining this in detail, let us review our example.</p>
</div>
<div class="paragraph">
<p>In an effort to keep the process model simple, <em>End</em> and <em>Start</em> are just plain
activities, only distinguished by their names ("start" or "end", respectively).
For the implementation, this means that any special behaviour needs to be bound
to the base entity <em>ActivityInstance</em> and as such results in it being applied
to <em>all</em> such instances, including those for <em>Tasks</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
*,** Hopefully, this also clears up any questions about why this special
behaviour for <em>End</em> should be relevant to <em>Tasks</em> at all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There&#8217;s nothing special to <em>Start</em> though, it has outgoing transitions like
other activities and it really just happens to be the initial activity in a
process (see <em>ProcessInstanceSupport.start()</em>), so it uses the default
behaviour. An <em>End</em> activity, however, is the final activity in a process,
which it should <em>end()</em>, and it also lacks outgoing transitions, which are the
reasons for binding this third behaviour class to <em>ActivityInstance</em>.</p>
</div>
<div class="paragraph">
<p>As for the <em>execute()</em> method, consider what you learned about <em>@Precedes</em> and
the method chaining. <em>EndInstanceSupport</em> precedes <em>ActivityInstanceSupport</em>
(no particular order with respect to <em>TaskInstanceSupport</em> given) and is going
to be called for <em>all</em> activities. It is, therefore, imperative that the
execute method does its special handling only when it actually deals with an
<em>End</em> activity, and falls back to the chain in all other cases (remember that
returning something null or a boolean false means that the chain continues with
- or falls back to - the next implementation up the chain).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="behaviour-registration"><a class="anchor" href="#behaviour-registration"></a>Behaviour registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have now taken a look at what needs to be done to implement our process
runtime using <em>Behaviours</em> and discussed a few details of doing so, but we
still haven&#8217;t seen how the binding of these behaviours to the mapped entities
from our model works.</p>
</div>
<div class="paragraph">
<p>As mentioned in the prerequisites, this example assumes you have taken a look
at the object mapping example, so this should look familiar.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example is also using code to set up the KOMMA framework from the
object mapping example, so be sure to import both projects into your workspace.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> RepositoryException {

        <span class="comment">// create a sesame repository</span>
        SailRepository dataRepository = <span class="keyword">new</span> SailRepository(<span class="keyword">new</span> MemoryStore());
        dataRepository.initialize();

        <span class="comment">// create an entity manager and register concepts</span>
        IEntityManager manager = createEntityManager(<span class="keyword">new</span> ExampleModule(
                        dataRepository, <span class="keyword">new</span> KommaModule() {
                                {
                                        <span class="comment">// model classes, definition</span>
                                        addConcept(DefinitionAspect.class);
                                        addConcept(ProcessDefinition.class);
                                        addConcept(ActivityDefinition.class);
                                        addConcept(TaskDefinition.class);
                                        addConcept(Transition.class);
                                        <span class="comment">// model classes, runtime</span>
                                        addConcept(RuntimeAspect.class);
                                        addConcept(ProcessInstance.class);
                                        addConcept(ActivityInstance.class);
                                        addConcept(TaskInstance.class);

                                        <span class="comment">// behaviour classes</span>
                                        addBehaviour(ProcessDefinitionSupport.class);
                                        addBehaviour(ProcessInstanceSupport.class);
                                        addBehaviour(ActivityDefinitionSupport.class);
                                        addBehaviour(ActivityInstanceSupport.class);
                                        addBehaviour(TaskDefinitionSupport.class);
                                        addBehaviour(TaskInstanceSupport.class);
                                        addBehaviour(EndInstanceSupport.class);
                                        addBehaviour(TransitionSupport.class);
                                }
                        }));

        demonstrateProcess(manager);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you compare this to the object mapping example, apart from obviously adding
the entity classes necessary for our process model, we simply add our behaviour
implementations, using the appropriately named <em>addBehaviour()</em> method - <em>and
that&#8217;s it!</em></p>
</div>
<div class="paragraph">
<p>This is really all that needs to be done for registering them. At runtime, the
composition framework uses the <em>@Iri</em> annotations to do the mapping and bind
the behaviours to the entities as needed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us demonstrate our simple process runtime by defining and executing a
short demo process. Again, the idea being to keep this simple, this will do:</p>
</div>
<div class="paragraph">
<p>Process 'DMC-12 Testrun': Start &#8594; Task1 'Invent Flux Capacitor' (Doc)
&#8594; Task2 'Experience Time Travel' (Einstein) &#8594; End</p>
</div>
<div class="paragraph">
<p>Fast forward beyond the initialization step where we define this process with
its activities and their transitions to the part where we execute it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> demonstrateProcess(IEntityManager manager) {
        <span class="comment">// [... initialize the example process ...]</span>

        <span class="comment">// create and start a new instance of the process</span>
        ProcessInstance processInstance = ((IProcessDefinition) processDef)
                        .createProcessInstance();

        <span class="comment">// [... create some output ...]</span>

        ActivityInstance ai1 = processInstance.getCurrentActivity();

        <span class="comment">// [... check state, create some output ...]</span>

        ((ITaskInstance) ai1).complete(<span class="predefined-constant">null</span>);

        <span class="comment">// [... refresh, create some output ...]</span>

        ActivityInstance ai2 = processInstance.getCurrentActivity();

        <span class="comment">// [... check state, create some output ...]</span>

        ((ITaskInstance) ai2).complete(<span class="predefined-constant">null</span>);

        <span class="comment">// [... refresh, create more output ...]</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Though a few things have been omitted in this snippet, the most relevant parts
where we actually use our API from within the simple test program show that
working with the behaviour classes is pretty straightforward.</p>
</div>
<div class="paragraph">
<p>If you run the program from the example using our short demo process, the
output looks somewhat like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">process urn:enilink.net:komma:behaviour-example#ProcessInstance_Process1_0e670c29-b3e3-4ea7-a1d0-9d6db521a3f6 is now in: state=active activity='Invent Flux Capacitor'
complete()ing current task: name='Invent Flux Capacitor', for='Emmett Lathrop 'Doc' Brown', state=awaiting_completion...
process urn:enilink.net:komma:behaviour-example#ProcessInstance_Process1_0e670c29-b3e3-4ea7-a1d0-9d6db521a3f6 is now in: state=active activity='Experience Time Travel'
complete()ing current task: name='Experience Time Travel', for='Einstein', state=awaiting_completion...
process urn:enilink.net:komma:behaviour-example#ProcessInstance_Process1_0e670c29-b3e3-4ea7-a1d0-9d6db521a3f6 is now in: state=ended activity='end'
**** Success! Process 'DMC-12 Testrun' has completed! ****
the following activities have been created:
urn:enilink.net:komma:behaviour-example#TaskInstance_ActivityTask1_031ace64-9543-49bb-b73b-dc96d2823280 name='Invent Flux Capacitor' state=completed transition=toTask2
urn:enilink.net:komma:behaviour-example#TaskInstance_ActivityTask2_730e8b4b-fcac-449b-85fd-16ea6b649451 name='Experience Time Travel' state=completed transition=toEnd
urn:enilink.net:komma:behaviour-example#ActivityInstance_ActivityStart_24ce367a-21e1-43f5-b4c6-4cd0e86d26c3 name='start' state=completed transition=toTask1
urn:enilink.net:komma:behaviour-example#ActivityInstance_ActivityEnd_1d45a4cb-bd83-4b2b-ad5e-3eaa10ede423 name='end' state=completed transition=null</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tldr"><a class="anchor" href="#tldr"></a>TL;DR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using KOMMA behaviours to bind business logic to mapped entities is a very
easy way to implement an application on top of RDF data.</p>
</div>
<div class="paragraph">
<p>You could start working with it right now!</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-01-19 07:19:12 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>